<div class="batches-list-container container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold mb-1">Batches & Lots</h2>
      <p class="text-muted mb-0">Track and manage product batches, lots and expiry dates.</p>
    </div>
    <div class="d-flex gap-2">
      <app-unified-button variant="primary" icon="bi-plus-lg" iconLibrary="bi" (clicked)="openCreateModal()">
        Create Batch
      </app-unified-button>
    </div>
  </div>

  <app-unified-card customClass="border-0 shadow-sm overflow-hidden">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
          <tr>
            <th>Batch Number</th>
            <th>Product</th>
            <th>Quantity</th>
            <th>Expiry Date</th>
            <th>Status</th>
            <th>Recall</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let b of batches">
            <td>
              <span class="fw-bold">{{b.batchNumber}}</span>
              <div class="smaller text-muted">Lot: {{b.lotNumber || 'N/A'}}</div>
            </td>
            <td>
              <div>{{b.productName}}</div>
              <div class="smaller text-muted">SKU: {{b.productSKU}}</div>
            </td>
            <td>{{b.totalQuantity}}</td>
            <td>
              <span [class.text-danger]="isExpired(b.expiryDate)">
                {{b.expiryDate | date:'mediumDate'}}
              </span>
              <div *ngIf="isExpiringSoon(b.expiryDate)" class="text-warning smaller">
                <i class="bi bi-clock-history"></i> Expiring Soon
              </div>
            </td>
            <td>
              <app-badge [color]="getStatusColor(b.status)">{{b.status}}</app-badge>
            </td>
            <td>
               <span *ngIf="b.isRecalled" class="text-danger fw-bold">RECALLED</span>
               <span *ngIf="!b.isRecalled" class="text-success">Active</span>
            </td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-danger" *ngIf="!b.isRecalled" (click)="recallBatch(b)">
                Recall
              </button>
            </td>
          </tr>
          <tr *ngIf="batches.length === 0 && !loading">
            <td colspan="7" class="text-center py-5">
              <div class="text-muted">No batches found</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </app-unified-card>

<app-create-batch
  [show]="showCreateModal"
  (close)="showCreateModal = false"
  (saved)="loadBatches()"
></app-create-batch>
</div>

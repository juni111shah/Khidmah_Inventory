<div class="product-form-container container-fluid py-4">
  <div *ngIf="loading" class="d-flex justify-content-center align-items-center py-5">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <div *ngIf="!loading" class="form-content">
    <div class="d-flex justify-content-start mb-4">
      <app-unified-button
        variant="secondary"
        [outlined]="true"
        size="sm"
        (clicked)="router.navigate(['/products'])"
        icon="bi-arrow-left"
        iconLibrary="bi">
        Back to Products
      </app-unified-button>
    </div>

    <div class="row g-4">
      <!-- Left Column: Core Info & Pricing -->
      <div class="col-lg-8">
        <!-- Basic Information -->
        <app-unified-card header="Basic Information" customClass="mb-4 border-0 shadow-sm">
          <div class="row g-3">
            <div class="col-12">
              <app-form-field
                label="Product Name"
                type="text"
                [(ngModel)]="formData.name"
                [required]="true">
              </app-form-field>
            </div>
            
            <div class="col-md-6">
              <app-form-field
                label="SKU"
                type="text"
                [(ngModel)]="formData.sku"
                [required]="true">
              </app-form-field>
            </div>
            
            <div class="col-md-6">
              <app-form-field
                label="Barcode"
                type="text"
                [(ngModel)]="formData.barcode">
              </app-form-field>
            </div>
            
            <div class="col-md-4">
              <app-form-field
                label="Category"
                type="select"
                [options]="getCategoryOptions()"
                [(ngModel)]="formData.categoryId">
              </app-form-field>
            </div>
            
            <div class="col-md-4">
              <app-form-field
                label="Brand"
                type="select"
                [options]="getBrandOptions()"
                [(ngModel)]="formData.brandId">
              </app-form-field>
            </div>
            
            <div class="col-md-4">
              <app-form-field
                label="Unit of Measure"
                type="select"
                [options]="getUnitOfMeasureOptions()"
                [(ngModel)]="formData.unitOfMeasureId"
                [required]="true">
              </app-form-field>
            </div>
            
            <div class="col-12">
              <app-form-field
                label="Description"
                type="textarea"
                [rows]="3"
                [(ngModel)]="formData.description">
              </app-form-field>
            </div>
          </div>
        </app-unified-card>

        <!-- Pricing -->
        <app-unified-card header="Pricing" customClass="border-0 shadow-sm">
          <div class="row g-3">
            <div class="col-md-4">
              <app-form-field
                label="Purchase Price"
                type="number"
                [(ngModel)]="formData.purchasePrice"
                icon="bi-currency-dollar"
                [required]="true">
              </app-form-field>
            </div>
            
            <div class="col-md-4">
              <app-form-field
                label="Sale Price"
                type="number"
                [(ngModel)]="formData.salePrice"
                icon="bi-tag"
                [required]="true">
              </app-form-field>
            </div>
            
            <div class="col-md-4">
              <app-form-field
                label="Cost Price"
                type="number"
                [(ngModel)]="formData.costPrice"
                icon="bi-cash">
              </app-form-field>
            </div>
          </div>
        </app-unified-card>
      </div>

      <!-- Right Column: Stock & Attributes -->
      <div class="col-lg-4">
        <!-- Stock Management -->
        <app-unified-card header="Stock Management" customClass="mb-4 border-0 shadow-sm">
          <div class="row g-3">
            <div class="col-12">
              <app-form-field
                label="Min Stock Level"
                type="number"
                [(ngModel)]="formData.minStockLevel">
              </app-form-field>
            </div>
            
            <div class="col-12">
              <app-form-field
                label="Max Stock Level"
                type="number"
                [(ngModel)]="formData.maxStockLevel">
              </app-form-field>
            </div>
            
            <div class="col-12">
              <app-form-field
                label="Reorder Point"
                type="number"
                [(ngModel)]="formData.reorderPoint">
              </app-form-field>
            </div>
            
            <div class="col-12 mt-3">
              <app-unified-checkbox [(ngModel)]="formData.trackQuantity" label="Track Quantity"></app-unified-checkbox>
              <app-unified-checkbox [(ngModel)]="formData.trackBatch" label="Track Batch Numbers"></app-unified-checkbox>
              <app-unified-checkbox [(ngModel)]="formData.trackExpiry" label="Track Expiry Dates"></app-unified-checkbox>
            </div>
          </div>
        </app-unified-card>

        <!-- Physical Attributes -->
        <app-unified-card header="Physical Attributes" customClass="border-0 shadow-sm">
          <div class="row g-3">
            <div class="col-6">
              <app-form-field
                label="Weight"
                type="number"
                [(ngModel)]="formData.weight">
              </app-form-field>
            </div>
            
            <div class="col-6">
              <app-form-field
                label="Unit"
                type="select"
                [options]="weightUnitOptions"
                [(ngModel)]="formData.weightUnit">
              </app-form-field>
            </div>
            
            <div class="col-4">
              <app-form-field label="Length" type="number" [(ngModel)]="formData.length"></app-form-field>
            </div>
            <div class="col-4">
              <app-form-field label="Width" type="number" [(ngModel)]="formData.width"></app-form-field>
            </div>
            <div class="col-4">
              <app-form-field label="Height" type="number" [(ngModel)]="formData.height"></app-form-field>
            </div>
            
            <div class="col-12">
              <app-form-field
                label="Dimensions Unit"
                type="select"
                [options]="dimensionsUnitOptions"
                [(ngModel)]="formData.dimensionsUnit">
              </app-form-field>
            </div>
          </div>
        </app-unified-card>
      </div>
    </div>

    <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
      <app-unified-button
        variant="secondary"
        [outlined]="true"
        (clicked)="router.navigate(['/products'])">
        Cancel
      </app-unified-button>
      
      <app-unified-button
        variant="primary"
        *appHasPermission="isEditMode ? 'Products:Update' : 'Products:Create'"
        (clicked)="save()"
        [loading]="saving"
        icon="bi-save"
        iconLibrary="bi">
        {{ isEditMode ? 'Update' : 'Create' }} Product
      </app-unified-button>
    </div>
  </div>

  <app-toast
    *ngIf="showToast"
    [message]="toastMessage"
    [type]="toastType"
    (close)="showToast = false">
  </app-toast>
</div>

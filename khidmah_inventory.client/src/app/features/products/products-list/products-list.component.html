<app-listing-container
  [searchPlaceholder]="config.searchPlaceholder || 'Search products...'"
  [searchTerm]="searchTerm"
  [totalColumnsCount]="columns.length"
  [visibleColumnsCount]="visibleColumnsCount"
  [columns]="columns"
  [showColumnDropdown]="showColumnToggle"
  [showFilters]="true"
  [showFilterPanel]="showFilterPanel"
  [filterCount]="filterRequest.filters?.length || 0"
  [hasActiveFilters]="(filterRequest.filters?.length || 0) > 0 || !!selectedCategoryId || isActiveFilter !== null"
  (search)="onSearch($event)"
  (filterClicked)="onFilterToggle()"
  (toggleColumns)="onColumnsToggle()"
  (closeColumns)="showColumnToggle = false"
  (columnToggle)="onColumnToggle($event)">
  
  <div listing-actions class="d-flex gap-2">
    <app-unified-button
      variant="secondary"
      [outlined]="true"
      (clicked)="router.navigate(['/products/barcode-scanner'])">
      <app-icon name="qr-code-scan" size="sm" customClass="me-2"></app-icon>
      Scan Barcode
    </app-unified-button>
    <app-unified-button variant="primary" (clicked)="addProduct()" *appHasPermission="'Products:Create'">
      <app-icon name="plus-circle" size="sm" customClass="me-2"></app-icon>
      Add Product
    </app-unified-button>
  </div>

  <div listing-export>
    <app-export
      [data]="products"
      [columns]="columns"
      [title]="'Products Export'"
      [filename]="'products'"
      [includeFilters]="true"
      [filters]="filterRequest.filters || []">
    </app-export>
  </div>

  <div filter-panel>
    <app-filter-panel
      [config]="filterPanelConfig"
      [filterValues]="filterPanelValues"
      (filterApplied)="onFilterApplied($event)"
      (filterReset)="onFilterReset()"
      (filterClose)="onFilterClose()">
    </app-filter-panel>
  </div>

  <app-data-table
    [columns]="columns"
    [data]="products"
    [loading]="loading"
    [config]="config"
    [actions]="actions"
    [pagedResult]="pagedResult"
    [filterRequest]="filterRequest"
    (filterChange)="onFilterChange($event)"
    (pageChange)="onPageChange($event)"
    (sortChange)="onSortChange($event)">
  </app-data-table>
</app-listing-container>

<app-toast
  *ngIf="showToast"
  [message]="toastMessage"
  [type]="toastType"
  (close)="showToast = false"
></app-toast>

<app-content-loader [loading]="loading">
  <ng-container skeleton>
    <div class="listing-container py-4">
      <div class="listing-card card border-0 shadow-sm p-4">
        <app-skeleton-listing-header [buttonCount]="3"></app-skeleton-listing-header>
        <app-skeleton-table [rows]="10" [columns]="5" [showHeader]="true"></app-skeleton-table>
      </div>
    </div>
  </ng-container>
  <app-listing-container
    data-onboarding="products-list-shell"
    [searchPlaceholder]="config.searchPlaceholder || 'Search products...'"
    [searchTerm]="searchTerm"
    [totalColumnsCount]="columns.length"
    [visibleColumnsCount]="visibleColumnsCount"
    [columns]="columns"
    [showColumnDropdown]="showColumnToggle"
    [showFilters]="true"
    [showFilterPanel]="showFilterPanel"
    [filterCount]="filterRequest.filters?.length || 0"
    [hasActiveFilters]="(filterRequest.filters?.length || 0) > 0 || !!selectedCategoryId || isActiveFilter !== null"
    (searchTermChange)="searchTerm = $event; onSearchTermChange($event)"
    (search)="onSearchImmediate($event)"
    (filterClicked)="onFilterToggle()"
    (toggleColumns)="onColumnsToggle()"
    (closeColumns)="showColumnToggle = false"
    (columnToggle)="onColumnToggle($event)">
    <div listing-actions class="d-flex gap-2 align-items-center" data-onboarding="products-list-actions">
      <app-saved-views-dropdown
        [tableId]="tableId"
        [currentState]="currentTableState"
        (loadView)="onSavedViewLoad($event)">
      </app-saved-views-dropdown>
      <app-unified-button
        variant="secondary"
        [outlined]="true"
        (clicked)="router.navigate(['/products/barcode-scanner'])"
        data-onboarding="products-list-scan-barcode">
        <app-icon name="qr-code-scan" size="sm" customClass="me-2"></app-icon>
        Scan Barcode
      </app-unified-button>
      <app-unified-button variant="primary" (clicked)="addProduct()" *appHasPermission="'Products:Create'" data-onboarding="products-list-create">
        <app-icon name="plus-circle" size="sm" customClass="me-2"></app-icon>
        Add Product
      </app-unified-button>
    </div>
    <div listing-export data-onboarding="products-list-export">
      <app-export
        [data]="products"
        [columns]="columns"
        [title]="'Products Export'"
        [filename]="'products'"
        [includeFilters]="true"
        [filters]="filterRequest.filters || []">
      </app-export>
    </div>
    <div filter-panel data-onboarding="products-list-filters">
      <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
          <a class="nav-link" [class.active]="!showFilterBuilder" (click)="showFilterBuilder = false" role="button">Quick filters</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="showFilterBuilder" (click)="showFilterBuilder = true" role="button">Filter builder</a>
        </li>
      </ul>
      <app-filter-panel
        *ngIf="!showFilterBuilder"
        [config]="filterPanelConfig"
        [filterValues]="filterPanelValues"
        (filterApplied)="onFilterApplied($event)"
        (filterReset)="onFilterReset()"
        (filterClose)="onFilterClose()">
      </app-filter-panel>
      <app-filter-builder
        *ngIf="showFilterBuilder"
        [columns]="filterBuilderColumns"
        [initialFilters]="filterRequest.filters || []"
        (apply)="onFilterBuilderApply($event)"
        (clear)="onFilterBuilderClear()">
      </app-filter-builder>
    </div>
    <app-data-table
      data-onboarding="products-list-table"
      [columns]="columns"
      [data]="products"
      [loading]="loading"
      [config]="config"
      [actions]="actions"
      [pagedResult]="pagedResult"
      [filterRequest]="filterRequest"
      (filterChange)="onFilterChange($event)"
      (pageChange)="onPageChange($event)"
      (sortChange)="onSortChange($event)">
    </app-data-table>
  </app-listing-container>
</app-content-loader>

<app-toast
  *ngIf="showToast"
  [message]="toastMessage"
  [type]="toastType"
  (close)="showToast = false"
></app-toast>

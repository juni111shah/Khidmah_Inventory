<div class="category-form-container container-fluid py-4">
  <div *ngIf="loading" class="d-flex justify-content-center align-items-center py-5">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <div *ngIf="!loading" class="form-content max-width-800 mx-auto">
    <div class="d-flex justify-content-start mb-4">
      <app-unified-button
        variant="secondary"
        [outlined]="true"
        size="sm"
        (clicked)="router.navigate(['/categories'])"
        icon="bi-arrow-left"
        iconLibrary="bi">
        Back to Categories
      </app-unified-button>
    </div>

    <app-unified-card header="Category Information" customClass="border-0 shadow-sm">
      <div class="row g-3">
        <div class="col-md-8">
          <app-form-field
            label="Category Name"
            type="text"
            [(ngModel)]="formData.name"
            [required]="true">
          </app-form-field>
        </div>
        <div class="col-md-4">
          <app-form-field
            label="Code"
            type="text"
            [(ngModel)]="formData.code"
            placeholder="Optional">
          </app-form-field>
        </div>
        <div class="col-12">
          <app-form-field
            label="Description"
            type="textarea"
            [(ngModel)]="formData.description"
            [rows]="3">
          </app-form-field>
        </div>
        <div class="col-md-8">
          <app-form-field
            label="Parent Category"
            type="select"
            [options]="parentOptions"
            [(ngModel)]="formData.parentCategoryId">
          </app-form-field>
        </div>
        <div class="col-md-4">
          <app-form-field
            label="Display Order"
            type="number"
            [(ngModel)]="formData.displayOrder"
            hint="Lower numbers appear first">
          </app-form-field>
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
        <app-unified-button
          variant="secondary"
          [outlined]="true"
          (clicked)="router.navigate(['/categories'])">
          Cancel
        </app-unified-button>
        
        <app-unified-button
          variant="primary"
          *appHasPermission="isEditMode ? 'Categories:Update' : 'Categories:Create'"
          (clicked)="save()"
          [loading]="saving"
          icon="bi-save"
          iconLibrary="bi">
          {{ isEditMode ? 'Update' : 'Create' }} Category
        </app-unified-button>
      </div>
    </app-unified-card>
  </div>

  <app-toast
    *ngIf="showToast"
    [message]="toastMessage"
    [type]="toastType"
    (close)="showToast = false">
  </app-toast>
</div>

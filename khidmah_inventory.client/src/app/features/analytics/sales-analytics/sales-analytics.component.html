<div class="analytics-container container-fluid py-4">
  <div class="d-flex justify-content-end mb-4">
    <app-time-range-filter
      [selectedRange]="selectedRange"
      [customFromDate]="customFromDate"
      [customToDate]="customToDate"
      (rangeChange)="onRangeChange($event)"
    ></app-time-range-filter>
  </div>

  <app-content-loader [loading]="loading">
    <ng-container skeleton>
      <div class="d-flex justify-content-end mb-4"><app-skeleton-loader [width]="'180px'" [height]="'38px'"></app-skeleton-loader></div>
      <app-skeleton-stat-cards [cardCount]="6" class="mb-4"></app-skeleton-stat-cards>
      <div class="row g-4 mb-4">
        <div class="col-lg-8"><app-skeleton-chart [chartHeight]="280" [showSubtitle]="false"></app-skeleton-chart></div>
        <div class="col-lg-4"><app-skeleton-chart [chartHeight]="280" [showSubtitle]="false"></app-skeleton-chart></div>
      </div>
      <app-unified-card header="" customClass="border-0 shadow-sm">
        <app-skeleton-table [rows]="6" [columns]="5" [showHeader]="true"></app-skeleton-table>
      </app-unified-card>
    </ng-container>
    <div *ngIf="!loading && analytics" class="analytics-content">
    <!-- Summary Cards (reusable KPI stat cards) -->
    <div class="row g-3 mb-4 equal-height-cards">
      <div class="col-md-4 col-lg-2">
        <app-kpi-stat-card title="Total Sales" [value]="formatCurrency(analytics.totalSales)" icon="bi-currency-dollar" theme="primary"></app-kpi-stat-card>
      </div>
      <div class="col-md-4 col-lg-2">
        <app-kpi-stat-card title="Total Cost" [value]="formatCurrency(analytics.totalCost)" icon="bi-cart" theme="info"></app-kpi-stat-card>
      </div>
      <div class="col-md-4 col-lg-2">
        <app-kpi-stat-card title="Total Profit" [value]="formatCurrency(analytics.totalProfit)" icon="bi-graph-up-arrow" theme="success"></app-kpi-stat-card>
      </div>
      <div class="col-md-4 col-lg-2">
        <app-kpi-stat-card title="Profit Margin" [value]="formatPercent(analytics.profitMargin)" icon="bi-percent" theme="primary"></app-kpi-stat-card>
      </div>
      <div class="col-md-4 col-lg-2">
        <app-kpi-stat-card title="Total Orders" [value]="formatNumber(analytics.totalOrders)" icon="bi-receipt" theme="info"></app-kpi-stat-card>
      </div>
      <div class="col-md-4 col-lg-2">
        <app-kpi-stat-card title="Avg Order" [value]="formatCurrency(analytics.averageOrderValue)" icon="bi-basket" theme="primary"></app-kpi-stat-card>
      </div>
    </div>

    <!-- Charts -->
    <div class="row g-4 mb-4 equal-height-cards">
      <div class="col-lg-8">
        <app-unified-card header="Sales Trend" customClass="border-0 shadow-sm h-100">
          <app-chart
            *ngIf="salesChartData"
            type="line"
            [data]="salesChartData"
            [options]="chartOptions"
          ></app-chart>
        </app-unified-card>
      </div>

      <div class="col-lg-4">
        <app-unified-card header="Sales by Category" customClass="border-0 shadow-sm h-100">
          <app-chart
            *ngIf="categoryChartData"
            type="bar"
            [data]="categoryChartData"
            [options]="chartOptions"
          ></app-chart>
        </app-unified-card>
      </div>
    </div>

    <!-- Top Lists -->
    <div class="row g-4 equal-height-cards">
      <div class="col-lg-6">
        <app-unified-card header="Top Products" customClass="border-0 shadow-sm h-100">
          <app-data-table
            *ngIf="analytics.topProducts"
            [columns]="topProductsColumns"
            [data]="analytics.topProducts"
            [config]="topProductsConfig"
            [loading]="false"
          ></app-data-table>
        </app-unified-card>
      </div>

      <div class="col-lg-6">
        <app-unified-card header="Top Customers" customClass="border-0 shadow-sm h-100">
          <app-data-table
            *ngIf="analytics.topCustomers"
            [columns]="topCustomersColumns"
            [data]="analytics.topCustomers"
            [config]="topCustomersConfig"
            [loading]="false"
          ></app-data-table>
        </app-unified-card>
      </div>
    </div>
  </div>
  </app-content-loader>

  <app-toast
    *ngIf="showToast"
    [message]="toastMessage"
    [type]="toastType"
    (close)="showToast = false"
  ></app-toast>
</div>


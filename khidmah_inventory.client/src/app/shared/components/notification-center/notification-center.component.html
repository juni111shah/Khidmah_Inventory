<div class="notification-center position-relative">
  <button type="button" class="notification-btn position-relative" (click)="toggle()" [attr.aria-label]="badgeCount > 0 ? 'Notifications, ' + badgeCount + ' unread' : 'Notifications'">
    <i class="bi bi-bell fs-5" aria-hidden="true"></i>
    <span *ngIf="badgeCount > 0" class="notification-badge">{{ badgeCount > 9 ? '9+' : badgeCount }}</span>
  </button>

  <div class="dropdown-menu dropdown-menu-end shadow position-absolute end-0 mt-1" style="min-width: 320px; max-height: 400px; overflow-y: auto;" *ngIf="open">
    <div class="d-flex justify-content-between align-items-center px-3 py-2 border-bottom">
      <h6 class="mb-0">Notifications</h6>
      <div>
        <button type="button" class="btn btn-link btn-sm p-0 text-decoration-none" (click)="goToNotificationsPage()">View all</button>
        <button type="button" class="btn btn-link btn-sm" (click)="close()"><i class="bi bi-x"></i></button>
      </div>
    </div>
    <div *ngIf="loading" class="px-3 py-4 text-center text-muted small">Loading...</div>
    <ng-container *ngIf="!loading">
      <a *ngFor="let n of notifications" href="javascript:void(0)" class="dropdown-item py-3 border-bottom d-block text-dark text-decoration-none" [class.notification-item]="true" [class.unread]="!n.isRead" (click)="go(n); $event.preventDefault()">
        <div class="d-flex">
          <i class="bi me-2 flex-shrink-0" [ngClass]="getIcon(n.type)"></i>
          <div class="min-w-0">
            <div class="fw-medium">{{ n.title }}</div>
            <small class="text-muted text-break">{{ n.message }}</small>
            <div class="small text-muted mt-1">{{ n.createdAt | date:'short' }}</div>
          </div>
        </div>
      </a>
      <div *ngIf="notifications.length === 0" class="px-3 py-4 text-center text-muted small">No notifications.</div>
    </ng-container>
  </div>
</div>

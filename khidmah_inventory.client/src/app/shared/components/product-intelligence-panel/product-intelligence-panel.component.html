<app-unified-card header="Product intelligence" footer="Analyze → Predict → Act">
  <div *ngIf="loading" class="d-flex justify-content-center py-3">
    <app-loading-spinner></app-loading-spinner>
  </div>
  <div *ngIf="error" class="alert alert-warning mb-0">{{ error }}</div>

  <div *ngIf="!loading && !error && data" class="intelligence-grid">
    <div class="row g-3">
      <div class="col-6 col-md-4">
        <div class="small text-muted">Sales velocity</div>
        <strong>{{ data.salesVelocity | number:'1.2-4' }}/day</strong>
      </div>
      <div class="col-6 col-md-4">
        <div class="small text-muted">Stock days left</div>
        <strong>{{ data.stockDaysRemaining ?? '—' }}</strong>
      </div>
      <div class="col-6 col-md-4">
        <div class="small text-muted">Reorder risk</div>
        <app-severity-badge
          [severity]="data.reorderRisk === 'Critical' ? 'Critical' : data.reorderRisk === 'High' ? 'High' : data.reorderRisk === 'Medium' ? 'Medium' : 'Low'"
          [label]="data.reorderRisk">
        </app-severity-badge>
      </div>
      <div class="col-6 col-md-4">
        <div class="small text-muted">Margin trend</div>
        <app-trend-arrow [trend]="marginTrend" [tooltip]="'Current ' + data.currentMarginPercent + '%'"></app-trend-arrow>
        <span class="ms-1">{{ data.currentMarginPercent }}%</span>
      </div>
      <div class="col-6 col-md-4">
        <div class="small text-muted">ABC class</div>
        <span class="badge bg-dark">{{ data.abcClassification }}</span>
        <span class="small ms-1">({{ data.abcRevenueSharePercent }}% revenue)</span>
      </div>
    </div>

    <div class="mt-3 pt-3 border-top">
      <div class="small text-muted mb-2">Recommended actions</div>
      <div class="d-flex flex-wrap gap-2">
        <span *ngFor="let a of data.recommendedActions" class="badge bg-light text-dark border">{{ a }}</span>
        <app-unified-button *ngIf="data.reorderRisk === 'Critical' || data.reorderRisk === 'High'" variant="primary" size="sm" (clicked)="goReorder()">Reorder</app-unified-button>
        <app-unified-button variant="secondary" size="sm" [outlined]="true" (clicked)="goInventory()">Stock levels</app-unified-button>
      </div>
    </div>

    <div *ngIf="data.priceHistory?.length" class="mt-3 pt-3 border-top">
      <div class="small text-muted mb-2">Price history (last 10)</div>
      <div class="small">
        <span *ngFor="let p of data.priceHistory.slice(0, 5)" class="me-2">{{ p.date | date:'shortDate' }}: {{ p.salePrice | currency }}</span>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !error && !data" class="text-muted small">No intelligence data for this product.</div>
</app-unified-card>
